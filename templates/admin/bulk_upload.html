{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Bulk Upload Users{% endblock %}

{% block content %}
<h1>Bulk Upload Users</h1>

<div class="module">
    <h2>Upload Excel File</h2>
    <p>Upload an Excel file (.xlsx or .xls) to create multiple users, technicians, and service requests at once.</p>
    
    <form method="post" enctype="multipart/form-data" style="margin-top: 20px;">
        {% csrf_token %}
        
        <div style="margin: 20px 0;">
            {{ form.as_p }}
        </div>
        
        <div style="margin: 20px 0;">
            <button type="submit" class="button" style="background: #417690; color: white; padding: 10px 30px; border: none; cursor: pointer; font-size: 14px; font-weight: bold;">
                Upload and Process
            </button>
        </div>
    </form>
</div>

<div class="module">
    <h2>Excel File Format</h2>
    <p>Your Excel file should contain the following columns:</p>
    
    <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
        <thead>
            <tr style="background: #f0f0f0;">
                <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">Column Name</th>
                <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">Required</th>
                <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">Description</th>
                <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">Example</th>
            </tr>
        </thead>
        <tbody>
            <!-- Common fields -->
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">Type</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Yes</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Customer or Technician</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Customer, Technician</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">Username</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Yes</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Unique username</td>
                <td style="padding: 10px; border: 1px solid #ddd;">john_doe</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">Email</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Yes</td>
                <td style="padding: 10px; border: 1px solid #ddd;">User email</td>
                <td style="padding: 10px; border: 1px solid #ddd;">john@example.com</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">Password</td>
                <td style="padding: 10px; border: 1px solid #ddd;">No</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Default: Welcome123 if not provided</td>
                <td style="padding: 10px; border: 1px solid #ddd;">mypassword123</td>
            </tr>
            
            <!-- Customer fields -->
            <tr style="background: #e8f5e9;">
                <td colspan="4" style="padding: 10px; font-weight: bold;">Customer-Specific Columns</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">Address</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Required for Service Request</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Melbourne address for service</td>
                <td style="padding: 10px; border: 1px solid #ddd;">123 Collins St, Melbourne VIC 3000</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">ServiceMinutes</td>
                <td style="padding: 10px; border: 1px solid #ddd;">No (default: 60)</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Duration in minutes</td>
                <td style="padding: 10px; border: 1px solid #ddd;">90</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">WindowStart</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Required</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Start time (datetime)</td>
                <td style="padding: 10px; border: 1px solid #ddd;">2025-10-28 09:00</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">WindowEnd</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Required</td>
                <td style="padding: 10px; border: 1px solid #ddd;">End time (datetime)</td>
                <td style="padding: 10px; border: 1px solid #ddd;">2025-10-28 17:00</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">RequiredSkills</td>
                <td style="padding: 10px; border: 1px solid #ddd;">No</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Comma-separated skills</td>
                <td style="padding: 10px; border: 1px solid #ddd;">electric, hvac</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">Priority</td>
                <td style="padding: 10px; border: 1px solid #ddd;">No (default: medium)</td>
                <td style="padding: 10px; border: 1px solid #ddd;">high, medium, low</td>
                <td style="padding: 10px; border: 1px solid #ddd;">high</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">ServiceType</td>
                <td style="padding: 10px; border: 1px solid #ddd;">No</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Service request name</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Emergency Repair</td>
            </tr>
            
            <!-- Technician fields -->
            <tr style="background: #e3f2fd;">
                <td colspan="4" style="padding: 10px; font-weight: bold;">Technician-Specific Columns</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">DepotAddress</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Required</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Melbourne depot address</td>
                <td style="padding: 10px; border: 1px solid #ddd;">456 Bourke St, Melbourne VIC 3000</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">CapacityHours</td>
                <td style="padding: 10px; border: 1px solid #ddd;">No (default: 8)</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Daily work hours</td>
                <td style="padding: 10px; border: 1px solid #ddd;">8</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">ShiftStart</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Required</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Start time (HH:MM)</td>
                <td style="padding: 10px; border: 1px solid #ddd;">08:00</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">ShiftEnd</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Required</td>
                <td style="padding: 10px; border: 1px solid #ddd;">End time (HH:MM)</td>
                <td style="padding: 10px; border: 1px solid #ddd;">17:00</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">Skills</td>
                <td style="padding: 10px; border: 1px solid #ddd;">No</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Comma-separated skills</td>
                <td style="padding: 10px; border: 1px solid #ddd;">electric, plumbing, hvac</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">ColorHex</td>
                <td style="padding: 10px; border: 1px solid #ddd;">No (default: #4285F4)</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Route color (hex)</td>
                <td style="padding: 10px; border: 1px solid #ddd;">#FF5733</td>
            </tr>
        </tbody>
    </table>
</div>

<div class="module" style="margin-top: 30px; padding: 20px; background: #fff3cd; border: 1px solid #ffc107;">
    <h2>Important Notes</h2>
    <ul>
        <li><strong>Addresses must be in Melbourne</strong> - The system will validate and reject non-Melbourne addresses.</li>
        <li><strong>Duplicate usernames</strong> - If username exists, the user will be updated with new data.</li>
        <li><strong>Default password</strong> - If password is not provided, default password "Welcome123" will be used.</li>
        <li><strong>Skills</strong> - If a skill doesn't exist, it will be created automatically.</li>
        <li><strong>Date formats</strong> - Accepts multiple datetime formats (YYYY-MM-DD HH:MM, DD/MM/YYYY HH:MM, etc.).</li>
    </ul>
</div>

<div class="module" style="margin-top: 20px;">
    <h2>Sample Excel File</h2>
    <p>You can include both customers and technicians in a single sheet. Mixed rows are supported.</p>
    
    <div style="background: #f5f5f5; padding: 15px; margin: 15px 0;">
        <pre>Type | Username | Email              | Address                      | ServiceMinutes | WindowStart        | WindowEnd          | RequiredSkills | Priority
Customer | john_doe | john@example.com | 123 Collins St, Melbourne | 90            | 2025-10-28 09:00 | 2025-10-28 17:00 | electric,hvac  | high
Technician | mary_smith | mary@example.com | 456 Bourke St, Melbourne  | 8              | 08:00            | 17:00            | electric       | 
Customer | jane_wilson | jane@example.com | 789 Swanston St, Melbourne| 60            | 2025-10-28 10:00 | 2025-10-28 16:00 | plumbing       | medium</pre>
    </div>
</div>

{% endblock %}

